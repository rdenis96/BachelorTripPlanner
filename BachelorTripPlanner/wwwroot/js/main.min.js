var globalModule=angular.module("globalModule",["ngRoute","ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngStorage","ui.bootstrap","ui.select","toastr","cgBusy"]);globalModule.config(["$routeProvider","$locationProvider","toastrConfig",function(n,t,i){n.when("/",{templateUrl:"AppViews/Home/home.html",controller:"HomeController"}).when("/home",{templateUrl:"AppViews/Home/home.html",controller:"HomeController"}).when("/welcome",{templateUrl:"AppViews/LandingPage/landingPage.html",controller:"LandingPageController"}).when("/account/interests",{templateUrl:"AppViews/Account/interests.html",controller:"AccountController"}).when("/account/planningHistory",{templateUrl:"AppViews/Account/planning-history.html",controller:"PlanningHistoryController"}).when("/account/editAccount",{templateUrl:"AppViews/Account/edit-account.html",controller:"AccountController"}).when("/trip/createTrip",{templateUrl:"AppViews/Trip/trip-create.html",controller:"TripCreateController"}).when("/trip/tripPlanner/:id",{templateUrl:"AppViews/Trip/trip-planner.html",controller:"TripPlannerController"}).when("/account/friends",{templateUrl:"AppViews/Account/friends.html",controller:"FriendsController"}).otherwise({redirectTo:"/"});angular.extend(i,{autoDismiss:!1,maxOpened:1,newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!1,preventOpenDuplicates:!1,target:"body",closeButton:!0,extendedTimeOut:5e3,timeOut:5e3});t.html5Mode(!0)}]);var landingPageTabsEnum={Welcome:"Welcome",Register:"Register",Login:"Login"},tripMainPageTabsEnum={MainTab:"Main",SingleTrip:"Single Trip",GroupTrip:"Group Trip"},tripTypeEnum={Single:0,Group:1},notificationTypes={TripInvitation:0,FriendRequest:1,TripKicked:2};globalModule.directive("interestsSlider",function(n,t){return{restrict:"E",scope:{interests:"="},link:function(i){var r={Bus:"Bus",Metro:"Metro",Train:"Train",Boat:"Boat",Tram:"Tram",Taxi:"Taxi",Underground:"Underground",Subway:"Subway",Helicopter:"Helicopter",Plane:"Plane",Rent:"Rent"},u,f;i.getTransportIcon=function(n){n=n.trim();switch(n){case r.Bus:return"Images/Common/BusIcon.png";case r.Metro:return"Images/Common/MetroIcon.png";case r.Train:return"Images/Common/TrainIcon.png";case r.Boat:return"Images/Common/BoatIcon.png";case r.Tram:return"Images/Common/TramIcon.png";case r.Taxi:return"Images/Common/TaxiIcon.png";case r.Underground:return"Images/Common/UndergroundIcon.png";case r.Subway:return"Images/Common/SubwayIcon.png";case r.Helicopter:return"Images/Common/HelicopterIcon.png";case r.Plane:return"Images/Common/PlaneIcon.png";case r.Rent:return"Images/Common/RentIcon.png"}};i.currentIndex=0;i.next=function(){i.currentIndex<i.interests.length-1?i.currentIndex++:i.currentIndex=0};i.prev=function(){i.currentIndex>0?i.currentIndex--:i.currentIndex=i.interests.length-1};i.openWikipediaTab=function(n){t.open(n,"_blank")};i.$watch("currentIndex",function(){i.interests.forEach(function(n){n.visible=!1});i.interests.length>0&&(i.interests[i.currentIndex].visible=!0)});f=function(){u=n(function(){i.next();u=n(f,4e3)},4e3)};f();i.$on("$destroy",function(){n.cancel(u)})},templateUrl:"AppViews/Home/home-suggested-interests-slidetemplate.html"}});globalModule.factory("homeRepository",["$resource",function(n){return n("api/home",{},{getSuggestedInterests:{method:"GET",url:"api/home/getSuggestedInterests",isArray:!0},getRandomInterests:{method:"GET",url:"api/home/getRandomInterests",isArray:!0}})}]);globalModule.controller("HomeController",["$scope","$window","$localStorage","homeRepository","toastr",function(n,t,i,r,u){n.userId=undefined;n.suggestedInterests=[];n.suggestedInterestsLoaded=!1;n.randomInterests=[];n.randomInterestsLoaded=!1;n.init=function(){n.userId=i.TPUserId;n.initSuggestedInterests()};n.initSuggestedInterests=function(){var i=r.getSuggestedInterests({userId:n.userId}).$promise,t;i.then(function(t){n.suggestedInterests=t;n.suggestedInterestsLoaded=!0}).catch(function(n){u.warning(n.data)});t=r.getRandomInterests().$promise;t.then(function(t){n.randomInterests=t;n.randomInterestsLoaded=!0}).catch(function(n){u.warning(n.data)})};n.init()}]);globalModule.factory("notificationsRepository",["$resource",function(n){return n("api/notifications",{},{getNotifications:{method:"GET",url:"api/notifications/getNotifications",isArray:!0},sendNotification:{method:"POST",url:"api/notifications/sendNotification"},respondNotification:{method:"POST",url:"api/notifications/respondNotification"},deleteNotification:{method:"POST",url:"api/notifications/deleteNotification"}})}]);globalModule.controller("HeaderController",["$scope","$window","$localStorage","$uibModal","homeRepository","tripRepository","notificationsRepository","toastr",function(n,t,i,r,u,f,e,o){n.notificationTypes=notificationTypes;n.isLogged=i.TPUserId!==null&&i.TPUserId!==undefined;n.init=function(){n.isLogged===!0?(n.userId=i.TPUserId,n.getUserGroupTrips(),n.getNotifications()):t.location.href.indexOf("/welcome")==-1&&(t.location.href="/welcome")};n.login=function(){var n=r.open({templateUrl:"AppViews/LandingPage/login-modal.html",controller:"LoginModalController",backdrop:"static",keyboard:!1,size:"lg"});n.result.then(function(){},function(){})};n.logout=function(){i.TPUserId=null;t.location.href="/welcome"};n.respondNotification=function(i,r){var u={IsAccepted:r,Notification:i};switch(i.type){case notificationTypes.TripInvitation:case notificationTypes.FriendRequest:n.respondNotificationPromise=e.respondNotification(u).$promise;n.respondNotificationPromise.then(function(){t.location.reload()}).catch(function(n){o.warning(n.data)});break;case notificationTypes.TripKicked:n.deleteNotificationPromise=e.deleteNotification(i).$promise;n.deleteNotificationPromise.then(function(){t.location.reload()}).catch(function(n){o.warning(n.data)})}};n.getUserGroupTrips=function(){n.getUserGroupTripsPromise=f.getUserHeaderTrips({userId:n.userId}).$promise;n.getUserGroupTripsPromise.then(function(t){n.userGroupTrips=t}).catch(function(n){o.warning(n.data)})};n.getNotifications=function(){n.getNotificationsPromise=e.getNotifications({userId:n.userId}).$promise;n.getNotificationsPromise.then(function(t){n.notifications=t}).catch(function(n){o.warning(n.data)})}}]);globalModule.controller("LandingPageController",["$scope","$window","$http","$localStorage","landingPageRepository","toastr",function(n,t,i,r,u,f){n.landingPage=!0;n.landingPageTabsEnum=landingPageTabsEnum;n.selectedTab=landingPageTabsEnum.Welcome;n.changeTab=function(t){switch(t){case landingPageTabsEnum.Welcome:n.selectedTab=landingPageTabsEnum.Welcome;break;case landingPageTabsEnum.Login:n.selectedTab=landingPageTabsEnum.Login;break;case landingPageTabsEnum.Register:n.selectedTab=landingPageTabsEnum.Register}};n.register=function(){i.get("https://ipapi.co/json/").success(function(t){n.registerIp=t.ip;var i={email:n.registerEmail,password:n.registerPassword,registerDate:new Date,lastOnline:null,ip:n.registerIp,phone:n.registerPhoneNumber!=undefined&&n.registerPhoneNumber.length>0?n.registerPhoneNumber:null},r=u.register(i).$promise;r.then(function(t){f.success(t.message);n.changeTab(landingPageTabsEnum.Login)}).catch(function(n){f.warning(n.data)})})};n.login=function(){var i={email:n.loginEmail,password:n.loginPassword},e=u.login(i).$promise;e.then(function(n){r.TPUserId=n.userId;t.location.href="/home";f.success(n.message)}).catch(function(n){console.log(n);f.warning(n.data)})}}]);globalModule.factory("landingPageRepository",["$resource",function(n){return n("api/landingpage",{},{register:{method:"POST",url:"api/landingpage/register"},login:{method:"GET",url:"api/landingpage/login"}})}]);globalModule.controller("AccountController",["$scope","$localStorage","$uibModal","accountRepository","toastr",function(n,t,i,r,u){n.user={};n.userInterests={};n.initEditAccount=function(){n.userId=t.TPUserId;var i=r.getUser({userId:n.userId}).$promise;i.then(function(t){n.user=t}).catch(function(n){u.warning(n.data)})};n.initInterests=function(){n.userId=t.TPUserId;n.getUserInterestPromise=r.getUserInterest({userId:n.userId}).$promise;n.getUserInterestPromise.then(function(t){n.userInterest=t}).catch(function(n){u.warning(n.data)})};n.openCountryAndCityModal=function(){var t=i.open({templateUrl:"AppViews/Account/interest-country-city-modal.html",controller:"AccountInterestsController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userInterest:n.userInterest}}}}).closed.then(function(){n.initInterests()})};n.openWeatherModal=function(){var t=i.open({templateUrl:"AppViews/Account/interest-weather-modal.html",controller:"AccountInterestsController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userInterest:n.userInterest}}}}).closed.then(function(){n.initInterests()})};n.openTransportsModal=function(){var t=i.open({templateUrl:"AppViews/Account/interest-transport-modal.html",controller:"AccountInterestsController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userInterest:n.userInterest}}}}).closed.then(function(){n.initInterests()})};n.openTouristAttractionsModal=function(){var t=i.open({templateUrl:"AppViews/Account/interest-tourist-attractions-modal.html",controller:"AccountInterestsController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userInterest:n.userInterest}}}}).closed.then(function(){n.initInterests()})};n.update=function(){if(n.newPassword!=n.confPassword){u.warning("The password does not match, please type the same password in Confirm Password field!");return}var t={email:n.user.email,password:n.newPassword},i=r.update({userId:n.userId},t).$promise;i.then(function(){u.success("The account was updated successfuly!")}).catch(function(n){u.warning(n.data)})}}]);globalModule.factory("accountRepository",["$resource",function(n){return n("api/account",{},{getUser:{method:"GET",url:"api/account/getUser"},getUserInterest:{method:"GET",url:"api/account/getUserInterest"},getAvailableCountries:{method:"GET",url:"api/account/GetAvailableCountries",isArray:!0},getAvailableCities:{method:"GET",url:"api/account/GetAvailableCities",isArray:!0},getUserCitiesByUserCountriesAndAvailableCities:{method:"GET",url:"api/account/GetUserCitiesByUserCountriesAndAvailableCities"},getAvailableWeather:{method:"GET",url:"api/account/GetAvailableWeather",isArray:!0},getAvailableTransport:{method:"GET",url:"api/account/GetAvailableTransport",isArray:!0},getAvailableTouristAttractions:{method:"GET",url:"api/account/GetAvailableTouristAttractions",isArray:!0},update:{method:"PUT",url:"api/account/update"},updateCountriesAndCities:{method:"PUT",url:"api/account/updateInterestByCountryAndCity"},updateWeather:{method:"PUT",url:"api/account/updateInterestByWeather"},updateTransport:{method:"PUT",url:"api/account/updateInterestByTransport"},updateTouristAttractions:{method:"PUT",url:"api/account/updateInterestByTouristAttractions"},getUserTrips:{method:"GET",url:"api/account/getUserTrips",isArray:!0},getFriends:{method:"GET",url:"api/account/getFriends",isArray:!0},removeFriend:{method:"GET",url:"api/account/removeFriend"},createFriend:{method:"POST",url:"api/account/createFriend"}})}]);globalModule.controller("AccountInterestsController",["$scope","data","$localStorage","accountRepository","toastr","$uibModalInstance",function(n,t,i,r,u,f){n.userInterest=t.userInterest;n.tripId=t.tripId;n.countriesList=[];n.citiesList=[];n.weatherList=[];n.transportList=[];n.touristAttractionsList=[];n.userWeather=[];n.userTransport=[];n.userTouristAttractions=[];n.initCountriesCities=function(){n.userId=i.TPUserId;var t={userId:n.userId,tripId:n.tripId};n.getAvailableCountriesPromise=r.getAvailableCountries(t).$promise;n.getAvailableCountriesPromise.then(function(t){n.countriesList=t;n.reInitCities()}).catch(function(n){u.warning(n.data)})};n.reInitCities=function(){var t={userId:n.userId,tripId:n.tripId,userCountries:n.userInterest.countries};n.getUserCitiesByUserCountriesAndAvailableCitiesPromise=r.getUserCitiesByUserCountriesAndAvailableCities(t).$promise;n.getUserCitiesByUserCountriesAndAvailableCitiesPromise.then(function(t){n.citiesList=t.availableCities;n.userInterest.cities=t.userCities}).catch(function(n){u.warning(n.data)})};n.initWeather=function(){n.userId=i.TPUserId;var t={userId:n.userId,tripId:n.tripId};n.getAvailableWeatherPromise=r.getAvailableWeather(t).$promise;n.getAvailableWeatherPromise.then(function(t){n.weatherList=t;n.userWeather=n.extractListFromString(n.userInterest.weather)}).catch(function(n){u.warning(n.data)})};n.initTransport=function(){n.userId=i.TPUserId;var t={userId:n.userId,tripId:n.tripId};n.getAvailableTransportPromise=r.getAvailableTransport(t).$promise;n.getAvailableTransportPromise.then(function(t){n.transportList=t;n.userTransport=n.extractListFromString(n.userInterest.transports)}).catch(function(n){u.warning(n.data)})};n.initTouristAttractions=function(){n.userId=i.TPUserId;var t={userId:n.userId,tripId:n.tripId};n.getAvailableTouristAttractionsPromise=r.getAvailableTouristAttractions(t).$promise;n.getAvailableTouristAttractionsPromise.then(function(t){n.touristAttractionsList=t;n.userTouristAttractions=n.userInterest.touristAttractions}).catch(function(n){u.warning(n.data)})};n.addCountry=function(){n.userInterest.countries.push(n.countriesList.selected);var t=n.countriesList.indexOf(n.countriesList.selected);n.countriesList.splice(t,1);n.countriesList.selected=undefined;n.reInitCities()};n.removeCountry=function(){n.countriesList.push(n.userInterest.countries.selected);var t=n.userInterest.countries.indexOf(n.userInterest.countries.selected);n.userInterest.countries.splice(t,1);n.userInterest.countries.selected=undefined;n.reInitCities()};n.addCity=function(){n.userInterest.cities.push(n.citiesList.selected);var t=n.citiesList.indexOf(n.citiesList.selected);n.citiesList.splice(t,1);n.citiesList.selected=undefined};n.removeCity=function(){n.citiesList.push(n.userInterest.cities.selected);var t=n.userInterest.cities.indexOf(n.userInterest.cities.selected);n.userInterest.cities.splice(t,1);n.userInterest.cities.selected=undefined};n.addWeather=function(){n.userWeather.push(n.weatherList.selected);var t=n.weatherList.indexOf(n.weatherList.selected);n.weatherList.splice(t,1);n.weatherList.selected=undefined};n.removeWeather=function(){n.weatherList.push(n.userWeather.selected);var t=n.userWeather.indexOf(n.userWeather.selected);n.userWeather.splice(t,1);n.userWeather.selected=undefined};n.addTransport=function(){n.userTransport.push(n.transportList.selected);var t=n.transportList.indexOf(n.transportList.selected);n.transportList.splice(t,1);n.transportList.selected=undefined};n.removeTransport=function(){n.transportList.push(n.userTransport.selected);var t=n.userTransport.indexOf(n.userTransport.selected);n.userTransport.splice(t,1);n.userTransport.selected=undefined};n.addTouristAttractions=function(){n.userTouristAttractions.push(n.touristAttractionsList.selected);var t=n.touristAttractionsList.indexOf(n.touristAttractionsList.selected);n.touristAttractionsList.splice(t,1);n.touristAttractionsList.selected=undefined};n.removeTouristAttractions=function(){n.touristAttractionsList.push(n.userTouristAttractions.selected);var t=n.userTouristAttractions.indexOf(n.userTouristAttractions.selected);n.userTouristAttractions.splice(t,1);n.userTouristAttractions.selected=undefined};n.submitCountriesAndCities=function(){var t={countries:n.userInterest.countries,cities:n.userInterest.cities,tripId:n.tripId};n.updateCountriesAndCitiesForUserPromise=r.updateCountriesAndCities({userId:n.userId},t).$promise;n.updateCountriesAndCitiesForUserPromise.then(function(n){n==null&&u.warning("Changes were not made, please try again!");f.close()}).catch(function(n){u.warning(n.data)})};n.submitWeather=function(){var t={weather:n.userWeather,tripId:n.tripId};n.updateWeatherForUserPromise=r.updateWeather({userId:n.userId},t).$promise;n.updateWeatherForUserPromise.then(function(n){n==null&&u.warning("Changes were not made, please try again!");f.close()}).catch(function(n){u.warning(n.data)})};n.submitTransport=function(){var t={transport:n.userTransport,tripId:n.tripId};n.updateTransportForUserPromise=r.updateTransport({userId:n.userId},t).$promise;n.updateTransportForUserPromise.then(function(n){n==null&&u.warning("Changes were not made, please try again!");f.close()}).catch(function(n){u.warning(n.data)})};n.submitTouristAttractions=function(){var t={touristAttractions:n.userTouristAttractions,tripId:n.tripId};n.updateTouristAttractionsForUserPromise=r.updateTouristAttractions({userId:n.userId},t).$promise;n.updateTouristAttractionsForUserPromise.then(function(n){n==null&&u.warning("Changes were not made, please try again!");f.close()}).catch(function(n){u.warning(n.data)})};n.extractListFromString=function(n){var t=[],i=n.replace(/[\s]/g,"").split(",");return angular.forEach(i,function(n){t.push(n)}),t};n.close=function(){f.close()}}]);globalModule.controller("PlanningHistoryController",["$scope","$window","$localStorage","$uibModal","accountRepository","tripRepository","toastr",function(n,t,i,r,u,f,e){n.user={};n.trips={};n.init=function(){n.userId=i.TPUserId;var t=u.getUserTrips({userId:n.userId}).$promise;t.then(function(t){n.trips=t}).catch(function(n){e.warning(n.data)})};n.containsSearchText=function(t){return n.searchText===null||n.searchText===undefined?!0:t.name.toLowerCase().indexOf(n.searchText.toLowerCase())!==-1};n.enableEdit=function(n){n.editMode=n.editMode===undefined||n.editMode===!1?!0:!n.editMode};n.redirectToTrip=function(n){n.isDeleted===!1&&(t.location.href="/trip/tripPlanner/"+n.id)};n.leaveTrip=function(t){n.leaveTripPromise=f.leaveTrip({userId:n.userId,tripId:t}).$promise;n.leaveTripPromise.then(function(){n.init()}).catch(function(n){e.warning(n.data)})};n.init()}]);globalModule.controller("FriendsController",["$scope","$window","$localStorage","$uibModal","accountRepository","toastr",function(n,t,i,r,u,f){n.friends={};n.init=function(){n.userId=i.TPUserId;var t=u.getFriends({userId:n.userId}).$promise;t.then(function(t){n.friends=t}).catch(function(n){f.warning(n.data)})};n.containsSearchText=function(t){return n.searchText===null||n.searchText===undefined?!0:t.name.toLowerCase().indexOf(n.searchText.toLowerCase())!==-1};n.addFriend=function(){var t=r.open({templateUrl:"AppViews/Account/friends-modal.html",controller:"FriendsModalController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userId:n.userId}}}}).closed.then(function(){n.init()})};n.removeFriend=function(t){n.removeFriendPromise=u.removeFriend({id:t}).$promise;n.removeFriendPromise.then(function(){n.init()}).catch(function(n){f.warning(n.data)})};n.init()}]);globalModule.controller("FriendsModalController",["$scope","data","$window","$http","$localStorage","$uibModalInstance","accountRepository","toastr","$routeParams","$uibModal",function(n,t,i,r,u,f,e,o){n.userId=t.userId;n.friendEmail="";n.submit=function(){n.createFriendPromise=e.createFriend({userId:n.userId,friendEmail:n.friendEmail}).$promise;n.createFriendPromise.then(function(){o.success("Friend request was sent to"+n.friendEmail);n.friendEmail=""}).catch(function(n){o.warning(n.data)})};n.close=function(){f.close()}}]);globalModule.controller("TripCreateController",["$scope","$window","$http","$location","$localStorage","tripCreateRepository","accountRepository","toastr",function(n,t,i,r,u,f,e,o){function s(n){return typeof n=="undefined"||n==null?!0:n.replace(/\s/g,"").length<1}function h(n){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase())}n.invitedPersonEmail="";n.invitedPeople=[];n.friends=[];n.tripMainPageTabsEnum=tripMainPageTabsEnum;n.tripTypeEnum=tripTypeEnum;n.selectedTab=tripMainPageTabsEnum.MainTab;n.init=function(){n.userId=u.TPUserId};n.changeTab=function(t){n.tripName="";switch(t){case tripMainPageTabsEnum.MainTab:n.selectedTab=tripMainPageTabsEnum.MainTab;break;case tripMainPageTabsEnum.SingleTrip:n.selectedTab=tripMainPageTabsEnum.SingleTrip;break;case tripMainPageTabsEnum.GroupTrip:n.selectedTab=tripMainPageTabsEnum.GroupTrip;n.loadFriends()}};n.goBackToMainTab=function(){n.tripName="";n.selectedTab=tripMainPageTabsEnum.MainTab};n.addInvitedPerson=function(){h(n.invitedPersonEmail)?n.invitedPeople.indexOf(n.invitedPersonEmail)!==-1?o.error("The typed person is already invited!"):(n.invitedPeople.push(n.invitedPersonEmail),n.invitedPersonEmail="",n.$apply()):o.error("The email is not valid!")};n.loadFriends=function(){n.getFriendsPromise=e.getFriends({userId:n.userId}).$promise;n.getFriendsPromise.then(function(t){n.friends=t}).catch(function(n){o.warning(n.data)})};n.onSelectedFriend=function(t){var i=n.invitedPeople.indexOf(t.friendAccount.email);i===undefined||i<0?(n.invitedPeople.push(t.friendAccount.email),n.$apply()):o.warning("The selected friend is already invited!")};n.removeInvitedPerson=function(t){var i=n.invitedPeople.indexOf(t);n.invitedPeople.splice(i,1);n.apply()};n.createTrip=function(t){var i,u;if(s(n.tripName)){o.error("Trip Name field must not be empty!");return}i={tripName:n.tripName,tripType:t==tripTypeEnum.Single?0:1};t==tripTypeEnum.Group&&angular.extend(i,{invitedPeople:n.invitedPeople});u=f.createTrip({userId:n.userId},i).$promise;u.then(function(n){n!=null&&r.url("/trip/tripPlanner/"+n.id)}).catch(function(n){o.warning(n.data)})};n.init()}]);globalModule.factory("tripCreateRepository",["$resource",function(n){return n("api/trip",{},{createTrip:{method:"POST",url:"api/trip/createTrip"}})}]);globalModule.controller("TripPlannerController",["$scope","$window","$http","$localStorage","tripRepository","toastr","$routeParams","$uibModal",function(n,t,i,r,u,f,e,o){n.invitedPersonEmail="";n.invitedPeople=[];n.suggestedInterests=[];n.isAdmin=!1;n.isGroupTrip=!1;n.messageText="";n.suggestedInterestsLoaded=!1;n.tripId=null;n.tripTypeEnum=tripTypeEnum;n.initInterests=function(){n.userId=r.TPUserId;n.getUserInterestPromise=u.getUserInterestForTrip({userId:n.userId,tripId:n.tripId}).$promise;n.getUserInterestPromise.then(function(t){n.userInterest=t;n.initInterestsForTrip();n.initMessagesForTrip()}).catch(function(n){f.warning(n.data)})};n.getTrip=function(t){n.getTripPromise=u.getTrip({tripId:t}).$promise;n.getTripPromise.then(function(t){n.isGroupTrip=t.type==tripTypeEnum.Group}).catch(function(n){f.warning(n.data)})};n.openCountryAndCityModal=function(){var t=o.open({templateUrl:"AppViews/Account/interest-country-city-modal.html",controller:"AccountInterestsController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userInterest:n.userInterest,tripId:n.tripId}}}}).closed.then(function(){n.initInterests()})};n.openWeatherModal=function(){var t=o.open({templateUrl:"AppViews/Account/interest-weather-modal.html",controller:"AccountInterestsController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userInterest:n.userInterest,tripId:n.tripId}}}}).closed.then(function(){n.initInterests()})};n.openTransportsModal=function(){var t=o.open({templateUrl:"AppViews/Account/interest-transport-modal.html",controller:"AccountInterestsController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userInterest:n.userInterest,tripId:n.tripId}}}}).closed.then(function(){n.initInterests()})};n.openTouristAttractionsModal=function(){var t=o.open({templateUrl:"AppViews/Account/interest-tourist-attractions-modal.html",controller:"AccountInterestsController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userInterest:n.userInterest,tripId:n.tripId}}}}).closed.then(function(){n.initInterests()})};n.resetUserInterests=function(){n.resetUserInterestsPromise=u.resetUserInterests({userId:n.userId,tripId:n.tripId}).$promise;n.resetUserInterestsPromise.then(function(t){t?n.initInterests():f.warning("A problem occured while reseting interests! Please try again!")}).catch(function(n){f.warning(n.data)})};n.leaveTrip=function(){n.leaveTripPromise=u.leaveTrip({userId:n.userId,tripId:n.tripId}).$promise;n.leaveTripPromise.then(function(){t.location.href="/"}).catch(function(n){f.warning(n.data)})};n.init=function(){n.userId=r.TPUserId;n.tripId=parseInt(e.id);n.getTrip(n.tripId);n.initInterests();n.setAdmin()};n.initInterestsForTrip=function(){n.getInterestsForTripPromise=u.getInterestsForTrip({tripId:n.tripId}).$promise;n.getInterestsForTripPromise.then(function(t){n.suggestedInterests=t;n.suggestedInterestsLoaded=!0}).catch(function(n){f.warning(n.data)})};n.initMessagesForTrip=function(){n.getInterestsForTripPromise=u.getMessagesForTrip({tripId:n.tripId}).$promise;n.getInterestsForTripPromise.then(function(t){n.messages=t.map(function(t){return{id:t.id,senderId:t.senderId,text:t.text,isSender:n.userId==t.senderId,date:t.date,senderEmail:t.senderEmail}})}).catch(function(n){f.warning(n.data)})};n.refreshMessages=function(){n.initMessagesForTrip()};n.sendMessage=function(){var t={senderId:n.userId,tripId:n.tripId,text:n.messageText,date:new Date};n.createMessagePromise=u.createMessage(t).$promise;n.createMessagePromise.then(function(){n.messageText="";n.initMessagesForTrip()}).catch(function(n){f.warning(n.data)})};n.getFirstLetterFromEmail=function(n){var t=n.trim();return t[0].toUpperCase().concat(t[1].toUpperCase())};n.setAdmin=function(){n.getUserAdmin=u.isUserAdmin({userId:n.userId,tripId:n.tripId}).$promise;n.getUserAdmin.then(function(t){n.isAdmin=t.isAdmin}).catch(function(n){f.warning(n.data)})};n.initManageMembersModal=function(){var t=o.open({templateUrl:"AppViews/Trip/trip-planner-manage-members-modal.html",controller:"TripPlannerManageMembersModalController",backdrop:"static",keyboard:!1,size:"lg",resolve:{data:function(){return{userId:n.userId,tripId:n.tripId,isAdmin:n.isAdmin}}}}).closed.then(function(){n.initInterests()})}}]);globalModule.controller("TripPlannerManageMembersModalController",["$scope","data","$window","$http","$localStorage","$uibModalInstance","tripRepository","accountRepository","toastr","$routeParams","$uibModal",function(n,t,i,r,u,f,e,o,s){n.userId=t.userId;n.tripId=t.tripId;n.isAdmin=t.isAdmin;n.newMemberEmail="";n.canShowNewMemberFields=!1;n.members=[];n.friends=[];n.enableAddNewMember=function(){n.canShowNewMemberFields?n.canShowNewMemberFields=!1:(n.newMemberEmail="",n.canShowNewMemberFields=!0)};n.addNewMember=function(){n.addNewMemberPromise=e.addNewTripMember({adminid:n.userId,tripId:n.tripId,newMemberEmail:n.newMemberEmail}).$promise;n.addNewMemberPromise.then(function(t){n.members=t}).catch(function(n){s.warning(n.data)})};n.loadFriends=function(){n.getFriendsPromise=o.getFriends({userId:n.userId}).$promise;n.getFriendsPromise.then(function(t){n.friends=t}).catch(function(n){s.warning(n.data)})};n.onSelectedFriend=function(t){n.newMemberEmail=t.friendAccount.email;n.$apply()};n.submit=function(){var t=[];n.members.forEach(function(n){t.push(n)});n.updateTripUsersPromise=e.updateTripUsers(t).$promise;n.updateTripUsersPromise.then(function(t){n.members=t}).catch(function(n){s.warning(n.data)})};n.removeUser=function(t){n.removeUserFromTripPromise=e.removeUserFromTrip({adminId:n.userId,userId:t.userId,tripId:n.tripId}).$promise;n.removeUserFromTripPromise.then(function(i){if(i){var r=n.members.indexOf(t);n.members.splice(r,1)}else s.warning("The user couldn't be removed from this trip!")}).catch(function(n){s.warning(n.data)})};n.close=function(){f.close()};n.init=function(){n.getTripUsersPromise=e.getTripUsers({tripId:n.tripId}).$promise;n.getTripUsersPromise.then(function(t){n.members=t;n.loadFriends()}).catch(function(n){s.warning(n.data)})};n.init()}]);globalModule.factory("tripRepository",["$resource",function(n){return n("api/trip",{},{getUserHeaderTrips:{method:"GET",url:"api/trip/getUserHeaderTrips",isArray:!0},getUserInterestForTrip:{method:"GET",url:"api/trip/getUserInterestForTrip"},getInterestsForTrip:{method:"GET",url:"api/trip/getSuggestedInterests",isArray:!0},getMessagesForTrip:{method:"GET",url:"api/trip/getMessages",isArray:!0},createMessage:{method:"POST",url:"api/trip/createMessage"},isUserAdmin:{method:"GET",url:"api/trip/isUserAdmin"},getTripUsers:{method:"GET",url:"api/trip/getTripUsers",isArray:!0},updateTripUsers:{method:"POST",url:"api/trip/updateTripUsers",isArray:!0},addNewTripMember:{method:"GET",url:"api/trip/addNewTripMember",isArray:!0},removeUserFromTrip:{method:"GET",url:"api/trip/removeUserFromTrip"},resetUserInterests:{method:"GET",url:"api/trip/resetUserInterests"},leaveTrip:{method:"GET",url:"api/trip/leaveTrip"},getTrip:{method:"GET",url:"api/trip/getTrip"}})}]);globalModule.controller("LoginModalController",["$scope","$window","$localStorage","$uibModalInstance","landingPageRepository","toastr",function(n,t,i,r,u,f){n.login=function(){var e={email:n.loginEmail,password:n.loginPassword},o=u.login(e).$promise;o.then(function(n){r.close();i.TPUserId=n.userId;t.location.href="/home";f.success(n.message)}).catch(function(n){console.log(n);f.warning(n.data)})};n.close=function(){r.close()}}]);